{"ast":null,"code":"'use strict';\n\nvar Registry = require('../../registry');\n\nvar Lib = require('../../lib');\n\nvar colorscaleDefaults = require('../../components/colorscale/defaults');\n\nvar attributes = require('./attributes');\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n  function coerce(attr, dflt) {\n    return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n  } // read in face/vertex properties\n\n\n  function readComponents(array) {\n    var ret = array.map(function (attr) {\n      var result = coerce(attr);\n      if (result && Lib.isArrayOrTypedArray(result)) return result;\n      return null;\n    });\n    return ret.every(function (x) {\n      return x && x.length === ret[0].length;\n    }) && ret;\n  }\n\n  var coords = readComponents(['x', 'y', 'z']);\n\n  if (!coords) {\n    traceOut.visible = false;\n    return;\n  }\n\n  readComponents(['i', 'j', 'k']); // three indices should be all provided or not\n\n  if (traceOut.i && (!traceOut.j || !traceOut.k) || traceOut.j && (!traceOut.k || !traceOut.i) || traceOut.k && (!traceOut.i || !traceOut.j)) {\n    traceOut.visible = false;\n    return;\n  }\n\n  var handleCalendarDefaults = Registry.getComponentMethod('calendars', 'handleTraceDefaults');\n  handleCalendarDefaults(traceIn, traceOut, ['x', 'y', 'z'], layout); // Coerce remaining properties\n\n  ['lighting.ambient', 'lighting.diffuse', 'lighting.specular', 'lighting.roughness', 'lighting.fresnel', 'lighting.vertexnormalsepsilon', 'lighting.facenormalsepsilon', 'lightposition.x', 'lightposition.y', 'lightposition.z', 'flatshading', 'alphahull', 'delaunayaxis', 'opacity'].forEach(function (x) {\n    coerce(x);\n  });\n  var showContour = coerce('contour.show');\n\n  if (showContour) {\n    coerce('contour.color');\n    coerce('contour.width');\n  }\n\n  if ('intensity' in traceIn) {\n    coerce('intensity');\n    coerce('intensitymode');\n    colorscaleDefaults(traceIn, traceOut, layout, coerce, {\n      prefix: '',\n      cLetter: 'c'\n    });\n  } else {\n    traceOut.showscale = false;\n    if ('facecolor' in traceIn) coerce('facecolor');else if ('vertexcolor' in traceIn) coerce('vertexcolor');else coerce('color', defaultColor);\n  }\n\n  coerce('text');\n  coerce('hovertext');\n  coerce('hovertemplate');\n  coerce('xhoverformat');\n  coerce('yhoverformat');\n  coerce('zhoverformat'); // disable 1D transforms\n  // x/y/z should match lengths, and i/j/k should match as well, but\n  // the two sets have different lengths so transforms wouldn't work.\n\n  traceOut._length = null;\n};","map":null,"metadata":{},"sourceType":"script"}