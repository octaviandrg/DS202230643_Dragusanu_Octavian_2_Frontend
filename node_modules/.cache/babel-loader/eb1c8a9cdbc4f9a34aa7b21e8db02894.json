{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar helpers = require('../sunburst/helpers');\n\nvar uniformText = require('../bar/uniform_text');\n\nvar clearMinTextSize = uniformText.clearMinTextSize;\n\nvar resizeText = require('../bar/style').resizeText;\n\nvar plotOne = require('./plot_one');\n\nmodule.exports = function _plot(gd, cdmodule, transitionOpts, makeOnCompleteCallback, opts) {\n  var type = opts.type;\n  var drawDescendants = opts.drawDescendants;\n  var fullLayout = gd._fullLayout;\n  var layer = fullLayout['_' + type + 'layer'];\n  var join, onComplete; // If transition config is provided, then it is only a partial replot and traces not\n  // updated are removed.\n\n  var isFullReplot = !transitionOpts;\n  clearMinTextSize(type, fullLayout);\n  join = layer.selectAll('g.trace.' + type).data(cdmodule, function (cd) {\n    return cd[0].trace.uid;\n  });\n  join.enter().append('g').classed('trace', true).classed(type, true);\n  join.order();\n\n  if (!fullLayout.uniformtext.mode && helpers.hasTransition(transitionOpts)) {\n    if (makeOnCompleteCallback) {\n      // If it was passed a callback to register completion, make a callback. If\n      // this is created, then it must be executed on completion, otherwise the\n      // pos-transition redraw will not execute:\n      onComplete = makeOnCompleteCallback();\n    }\n\n    var transition = d3.transition().duration(transitionOpts.duration).ease(transitionOpts.easing).each('end', function () {\n      onComplete && onComplete();\n    }).each('interrupt', function () {\n      onComplete && onComplete();\n    });\n    transition.each(function () {\n      // Must run the selection again since otherwise enters/updates get grouped together\n      // and these get executed out of order. Except we need them in order!\n      layer.selectAll('g.trace').each(function (cd) {\n        plotOne(gd, cd, this, transitionOpts, drawDescendants);\n      });\n    });\n  } else {\n    join.each(function (cd) {\n      plotOne(gd, cd, this, transitionOpts, drawDescendants);\n    });\n\n    if (fullLayout.uniformtext.mode) {\n      resizeText(gd, layer.selectAll('.trace'), type);\n    }\n  }\n\n  if (isFullReplot) {\n    join.exit().remove();\n  }\n};","map":null,"metadata":{},"sourceType":"script"}