{"ast":null,"code":"'use strict';\n\nvar setGroupPositions = require('../bar/cross_trace_calc').setGroupPositions;\n\nmodule.exports = function crossTraceCalc(gd, plotinfo) {\n  var fullLayout = gd._fullLayout;\n  var fullData = gd._fullData;\n  var calcdata = gd.calcdata;\n  var xa = plotinfo.xaxis;\n  var ya = plotinfo.yaxis;\n  var funnels = [];\n  var funnelsVert = [];\n  var funnelsHorz = [];\n  var cd, i;\n\n  for (i = 0; i < fullData.length; i++) {\n    var fullTrace = fullData[i];\n    var isHorizontal = fullTrace.orientation === 'h';\n\n    if (fullTrace.visible === true && fullTrace.xaxis === xa._id && fullTrace.yaxis === ya._id && fullTrace.type === 'funnel') {\n      cd = calcdata[i];\n\n      if (isHorizontal) {\n        funnelsHorz.push(cd);\n      } else {\n        funnelsVert.push(cd);\n      }\n\n      funnels.push(cd);\n    }\n  }\n\n  var opts = {\n    mode: fullLayout.funnelmode,\n    norm: fullLayout.funnelnorm,\n    gap: fullLayout.funnelgap,\n    groupgap: fullLayout.funnelgroupgap\n  };\n  setGroupPositions(gd, xa, ya, funnelsVert, opts);\n  setGroupPositions(gd, ya, xa, funnelsHorz, opts);\n\n  for (i = 0; i < funnels.length; i++) {\n    cd = funnels[i];\n\n    for (var j = 0; j < cd.length; j++) {\n      if (j + 1 < cd.length) {\n        cd[j].nextP0 = cd[j + 1].p0;\n        cd[j].nextS0 = cd[j + 1].s0;\n        cd[j].nextP1 = cd[j + 1].p1;\n        cd[j].nextS1 = cd[j + 1].s1;\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"script"}